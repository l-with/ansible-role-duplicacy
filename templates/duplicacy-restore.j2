#!/bin/sh

# cd to working directory
cd {{ duplicacy_working_directory }}

# env
{% for _env in _duplicacy_env %}
export {{ _env }}="{{ _duplicacy_env[_env] }}"
{% endfor %}

# env restore
{% for _env in _duplicacy_env_restore %}
export {{ _env }}="{{ _duplicacy_env_restore[_env] }}"
{% endfor %}
 
# env special
{% for _env in _duplicacy_env_special %}
export {{ _env }}="{{ _duplicacy_env_special[_env] }}"
{% endfor %}

# restore
export _duplicacy_backup_revision=$({{ duplicacy_path }}/bin/duplicacy list | tail -n 1 | cut -d " " -f 4)
{{ duplicacy_path }}/bin/duplicacy restore {{ duplicacy_restore_options }} {{ duplicacy_snapshot_id }} -r $_duplicacy_backup_revision
